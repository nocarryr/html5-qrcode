!function($){var overlayStyle={position:"absolute","background-color":"transparent","border-style":"solid","border-color":"rgba(255, 255, 0, 0.5)","border-width":"1px","z-index":"20"};jQuery.fn.extend({html5_qrcode:function(qrcodeSuccess,qrcodeError,videoError){return this.each(function(){var currentElem=$(this),height=currentElem.height(),width=currentElem.width();null==height&&(height=250),null==width&&(width=300);var cropFactor=currentElem.data("crop-factor");"undefined"==typeof cropFactor&&(cropFactor=1);var canvasCoords={dx:0,dy:0};height>width?(canvasCoords.w=width*cropFactor,canvasCoords.h=canvasCoords.w):(canvasCoords.h=height*cropFactor,canvasCoords.w=canvasCoords.h),canvasCoords.sx=(width-canvasCoords.w)/2,canvasCoords.sy=(height-canvasCoords.h)/2,overlayStyle.left=canvasCoords.sx+currentElem.offset().left,overlayStyle.top=canvasCoords.sy+currentElem.offset().top,overlayStyle.width=canvasCoords.w,overlayStyle.height=canvasCoords.h;var vidElem=$("<video autoplay></video>").attr("width",width).attr("height",height).appendTo(currentElem),canvasElem=$('<canvas id="qr-canvas"></canvas>').attr("width",canvasCoords.w).attr("height",canvasCoords.h).hide().appendTo(currentElem),overlayElem=$();1!==cropFactor&&(overlayElem=$('<div class="qr-overlay"></div>').css(overlayStyle).appendTo(currentElem.offsetParent())),currentElem.data("overlayElem",overlayElem);var localMediaStream,video=vidElem[0],canvas=canvasElem[0],context=canvas.getContext("2d"),scan=function(){if(localMediaStream){"undefined"==typeof canvasCoords.sWidth&&(canvasCoords.sx=(video.width-canvasCoords.w)/2,canvasCoords.sy=(video.height-canvasCoords.h)/2,canvasCoords.sWidth=video.width,canvasCoords.sHeight=video.height),context.drawImage(video,canvasCoords.sx,canvasCoords.sy,canvasCoords.sWidth,canvasCoords.sHeight,canvasCoords.dx,canvasCoords.dy,canvasCoords.w,canvasCoords.h);try{qrcode.decode()}catch(e){qrcodeError(e,localMediaStream)}$.data(currentElem[0],"timeout",setTimeout(scan,500))}else $.data(currentElem[0],"timeout",setTimeout(scan,500))};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var successCallback=function(stream){video.src=window.URL&&window.URL.createObjectURL(stream)||stream,localMediaStream=stream,$.data(currentElem[0],"stream",stream),$.data(currentElem[0],"timeout",setTimeout(scan,1e3))};if(navigator.getUserMedia){if(void 0===MediaStreamTrack||void 0===MediaStreamTrack.getSources){var mediaConstraints={video:!0};return void navigator.getUserMedia(mediaConstraints,successCallback,function(error){videoError(error,localMediaStream)})}MediaStreamTrack.getSources(function(sources){var rearCameras=sources.filter(function(source){return"environment"===source.facing});if(0===rearCameras.length){var mediaConstraints={video:!0};return void navigator.getUserMedia(mediaConstraints,successCallback,function(error){videoError(error,localMediaStream)})}var mediaConstraints={video:{optional:[{sourceId:rearCameras[0].id}]}};navigator.getUserMedia(mediaConstraints,successCallback,function(error){videoError(error,localMediaStream)})})}else console.log("Native web camera streaming (getUserMedia) not supported in this browser.");return qrcode.callback=function(result){qrcodeSuccess(result,localMediaStream)},currentElem})},html5_qrcode_stop:function(){return this.each(function(){var $this=$(this);return $this.data("overlayElem").remove(),"undefined"!=typeof $this.data("stream")&&$this.data("stream").getVideoTracks().forEach(function(videoTrack){videoTrack.stop()}),clearTimeout($this.data("timeout")),$this})}})}(jQuery);